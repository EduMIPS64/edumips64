<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>EduMIPS64 Experimental Web Frontend</title>

      <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">

      <!-- Responsive grid for Pure CSS -->
      <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-old-ie-min.css">
      <![endif]-->
      <!--[if gt IE 8]><!-->
      <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
      <!--<![endif]-->


      <script type="text/javascript" language="javascript" src="edumips64.nocache.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

      <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
      <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
      <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

      <style media="screen" type="text/css">
          textarea {
              width: 90%;
              height: 400px;
          }

          #run-button {
              width: 90%;
          }
          body {
            padding: 15px;
          }
      </style>

      <script type="text/babel">
      const Registers = (props) => {
        return <div className="pure-u-1 pure-u-lg-1-4">
          <textarea readOnly value={props.registers} />
         </div>;
      }

      const Statistics = (props) => {
        return <div className="pure-u-1 pure-u-lg-1-4">
          <textarea id="statistics" readOnly value={props.stats} />
        </div>;
      }
      const Memory = (props) => {
        return <div className="pure-u-1 pure-u-lg-1-4">
          <textarea id="memory" readOnly value={props.memory} />
        </div>;
      }

      class Code extends React.Component {
        constructor(props) {
          super(props)
        }

        handleChange = (event) => {
          this.props.onChangeValue(event.target.value)
          event.preventDefault();
        }

        render() {
          return <div className="pure-u-1 pure-u-lg-1-4">
            <textarea 
              value={this.props.code}
              onChange={this.handleChange}
              />
              <br />
              <input type="button" value="Run" onClick={() => {this.props.onClick()}}/>
          </div>
        }
      }

      const Simulator = (props) => {
        const [registers, setRegisters] = React.useState("Registers will appear here.");
        const [memory, setMemory] = React.useState("Memory will appear here.");
        const [stats, setStats] = React.useState("Statistics will appear here");
        const [code, setCode] = React.useState(`
  ; Example program. Loads the value 10 (A) into R1.
  .data
    .word64 10

  .code
    lw r1, 0(r0)
    SYSCALL 0
`);

        const runCode = () => {
          console.log("Executing runCode");
          const simulator = new jsedumips64.WebUi();
          simulator.init();
          const result = simulator.runProgram(code);
          if (result.length != 0) {
              alert(result);
          } else {
            setRegisters(simulator.getRegisters());
            setMemory(simulator.getMemory());
            setStats(simulator.getStatistics());
          }
        }

        return (<React.Fragment>
          <Code onClick={runCode} onChangeValue ={(text) => setCode(text)} code={code}/>
          <Registers registers={registers}/>
          <Memory memory={memory}/>
          <Statistics stats={stats}/>
        </React.Fragment>);
      }

      ReactDOM.render(
        <Simulator />,
        document.getElementById('simulator')
      );
      </script>
  </head>
  <body bgcolor="white">
  <img alt='EduMIPS64' height='98px; ' src='logo.png' style='display: block' width='350px; '/>
  <h2>Web interface proof-of-concept</h2>
  <p>This is a crude proof-of-concept of how it is possible to interact with the EduMIPS64 core in Javascript.</p>
    <noscript>
      <div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color:white; border: 1px solid red; padding: 4px; font-family: sans-serif">
        Your web browser must have JavaScript enabled
        in order for this application to display correctly.
      </div>
    </noscript>
  <div class="pure-g" id="simulator">
  </div>
  </body>
</html>
